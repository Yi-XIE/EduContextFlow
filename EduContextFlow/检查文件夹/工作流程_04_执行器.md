# ⚡ 执行器工作流程 (Executor)

**文件**：`executor.py`

## 1. 职责边界 (Pure Execution)
- **输入**：接收 App 层已经拼接好的、包含完整上下文的 `input_text`。
- **职责**：纯粹的执行引擎，**禁止**读取 `context_index`，**禁止**推理，**禁止**做任何业务判断。

## 2. 文本生成逻辑 (`_generate_text`)
1. **模板填充**：将 `input_text` 填入 `skill.prompt_template`。
2. **API 调用**：调用 `llm.complete(prompt)`，带重试和指数退避机制。
3. **输出清理 (Output Cleaning)**：
   - 调用 `_clean_llm_output()`。
   - 三阶段过滤：移除复述开头、定位正文开始点、移除纯元描述。
4. **文件持久化**：将清理后的正文写入 `outputs/`。

## 3. 图像生成逻辑 (`_generate_image`)
1. **提示词生成**：调用 LLM 将用户描述转换为专业的英文生成提示词。
2. **写日志**：将生成的英文提示词保存为 `outputs/image_prompt.txt` 供检查。
3. **调用图像模型**：调用 Imagen API 生成二进制图片。
4. **写文件**：保存为 `outputs/image.png`。

## 4. 返回结果
- 向 App 层返回生成文件的相对路径（如 `outputs/transcript.md`）。

